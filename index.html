<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Three.js Example with Clickable Points and Camera Movement</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #9e7aad;
            overflow: hidden; /* Hide overflow to prevent scrolling */
            background: url('1092.jpg') no-repeat center center fixed;
            background-size: cover; /* Cover the entire background */
        }
        canvas {
            display: block;
        }
        #container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }
        #toggleControls, #toggleSidebar {
            position: absolute;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            outline: none;
            border: none;
            border-radius: 5px;
            color: white;
            transition: background-color 0.3s ease;
        }
        #toggleControls {
            top: 20px;
            left: 20px;
            background-color: #a8b0b9;
        }
        #toggleControls:hover {
            background-color: #335a82;
        }
        #toggleSidebar {
            top: 20px;
            right: 20px;
            background-color: #28a745;
        }
        #toggleSidebar:hover {
            background-color: #6cba7d;
        }
        #sidebar {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 200px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: none;
        }
        #sidebar button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            font-size: 16px;
            background-color: #ab67b4;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            outline: none;
        }
        #sidebar button:hover {
            background-color: #0056b3;
        }
        #sidebar button:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body>
    <div id="container"></div>
    <button id="toggleControls">Toggle Orbit Controls</button>
    <button id="toggleSidebar">Toggle Sidebar</button>
    <div id="sidebar">
        <button id="livingRoomButton">Living Room</button>
        <button id="rooftopButton">Rooftop Room</button>
        <button id="balconyButton">Balcony</button>
        <button id="frontButton">Front</button>
        <button id="backButton">Back</button>
    </div>

    <!-- Three.js library -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.147.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.147.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.147.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.147.0/examples/js/loaders/DRACOLoader.js"></script>
    
    <!-- GSAP library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.10.1/gsap.min.js"></script>
    
    <!-- dat.GUI library -->
    <script src="https://cdn.jsdelivr.net/npm/dat.gui@0.7.9/build/dat.gui.min.js"></script>
    
    <script>
        // Create the scene
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x008080); // Set blue-green background color

        // Create a camera
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(36, 6.4, 12);  // Updated default position
        camera.rotation.set(-0.49, 1.21, 0.46);  // Updated default rotation

        // Create a directional light
        const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
        directionalLight.position.set(10, 10, 0); // Set the position of the light
        scene.add(directionalLight);

        // Add ambient light to the scene
        const ambientLight = new THREE.AmbientLight(0xffffff, 1);
        scene.add(ambientLight);

        // Create a renderer
        const renderer = new THREE.WebGLRenderer({ alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('container').appendChild(renderer.domElement);

        // Add OrbitControls
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true; // Enable damping (inertia)
        controls.dampingFactor = 0.25; // Set damping factor
        controls.enableZoom = true; // Enable zoom

        let model; // Variable to store the loaded model

        // Create a loader for loading the GLB file with Draco compression
        const loader = new THREE.GLTFLoader();
        const dracoLoader = new THREE.DRACOLoader();
        dracoLoader.setDecoderPath('https://cdn.jsdelivr.net/npm/three@0.147.0/examples/js/libs/draco/');
        loader.setDRACOLoader(dracoLoader);

        // Load the GLB file
        loader.load('home1.glb', function (gltf) {
            model = gltf.scene;
            scene.add(model);

            // Adjust the position, rotation, and scale of the model
            model.position.set(8, -1, -1);
            model.rotation.set(0, 1, 0);
            model.scale.set(2, 2, 2);
            console.log('Model loaded');

            // Initialize GUI controls for the camera
            initGUI();

            // Add points to the scene
            addClickablePoints();
        }, undefined, function (error) {
            console.error('An error occurred while loading the model:', error);
        });


        // Initialize GUI controls for the camera
        let gui, cameraFolder, cameraPositionFolder, cameraRotationFolder;

        // Function to initialize GUI controls
        function initGUI() {
            gui = new dat.GUI();

            // Camera properties
            cameraFolder = gui.addFolder('Camera Properties');
            cameraPositionFolder = cameraFolder.addFolder('Position');
            cameraRotationFolder = cameraFolder.addFolder('Rotation');

            cameraPositionFolder.add(camera.position, 'x', -200, 200).listen();
            cameraPositionFolder.add(camera.position, 'y', -200, 200).listen();
            cameraPositionFolder.add(camera.position, 'z', -200, 200).listen();

            cameraRotationFolder.add(camera.rotation, 'x', -Math.PI, Math.PI).listen();
            cameraRotationFolder.add(camera.rotation, 'y', -Math.PI, Math.PI).listen();
            cameraRotationFolder.add(camera.rotation, 'z', -Math.PI, Math.PI).listen();

            cameraFolder.open();
            cameraPositionFolder.open();
            cameraRotationFolder.open();
        }

        // Add event listeners to update GUI controls when OrbitControls change
        controls.addEventListener('change', () => {
            gui.updateDisplay();
        });

        // Toggle button for OrbitControls
        let orbitControlsEnabled = true;
        document.getElementById('toggleControls').addEventListener('click', function () {
            orbitControlsEnabled = !orbitControlsEnabled;
            controls.enabled = orbitControlsEnabled;
            this.textContent = orbitControlsEnabled ? 'Disable Orbit Controls' : 'Enable Orbit Controls';
        });

        // Function to move the camera to a specific position with a transition
        function moveCamera(position, rotation, rightMoveDuration = 2) {
            const easeDuration = 2; // Duration in seconds for easing

            // Fast initial movement
            gsap.to(camera.position, {
                x: position.x,
                y: position.y,
                z: position.z,
                duration: easeDuration,
                onUpdate: function () {
                    camera.updateProjectionMatrix();
                }
            });

            gsap.to(camera.rotation, {
                x: rotation.x,
                y: rotation.y,
                z: rotation.z,
                duration: easeDuration,
                ease: Power1.easeInOut,
                onUpdate: function () {
                    camera.updateProjectionMatrix();
                }
            });

            // Hide all clickable points during the transition
            clickablePoints.forEach(point => {
                point.visible = false;
            });

            // Show points again after the transition completes
            gsap.delayedCall(easeDuration, () => {
                clickablePoints.forEach(point => {
                    point.visible = true;
                });
            });

            // Move camera right after reaching the position
            gsap.delayedCall(easeDuration + 0.5, () => {
                const forward = new THREE.Vector3(0, 0, -1);
                forward.applyQuaternion(camera.quaternion);
                const rightVector = new THREE.Vector3();
                rightVector.crossVectors(forward, camera.up);

                gsap.to(camera.position, {
                    x: camera.position.x + rightVector.x * 5,
                    y: camera.position.y + rightVector.y * 5,
                    z: camera.position.z + rightVector.z * 5,
                    duration: rightMoveDuration,
                    onUpdate: function () {
                        camera.updateProjectionMatrix();
                    }
                });
            });
        }

        // Array to store clickable points
        const clickablePoints = [];

        // Function to add clickable points to the scene
        function addClickablePoints() {
            const points = [
                { position: new THREE.Vector3(29, 8.4, -11), label: 'Living Room' },
                { position: new THREE.Vector3(19, 25, -6), label: 'Rooftop Room' },
                { position: new THREE.Vector3(6, 10.5, 29), label: 'Balcony' },
                { position: new THREE.Vector3(35, 4.5, 18), label: 'Front' },
                { position: new THREE.Vector3(-25, 11, -24), label: 'Back' }
            ];

            points.forEach(point => {
                const geometry = new THREE.SphereGeometry(0.8, 16, 16); // Smaller size
                const material = new THREE.MeshBasicMaterial({ color: 0xfffdd0 }); // Cream white color
                const sphere = new THREE.Mesh(geometry, material);
                sphere.position.copy(point.position);
                scene.add(sphere);

                sphere.userData = { label: point.label, position: point.position };
                clickablePoints.push(sphere);
            });
        }

        // Handle mouse click
        function onDocumentMouseClick(event) {
            event.preventDefault();
            const mouse = new THREE.Vector2();
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(mouse, camera);

            const intersects = raycaster.intersectObjects(clickablePoints);
            if (intersects.length > 0) {
                const point = intersects[0].object.userData.position;
                moveCamera(point, { x: 0, y: 0, z: 0 }); // Change rotation as needed
            }
        }

        document.addEventListener('click', onDocumentMouseClick, false);

        // Render loop
        function animate() {
            requestAnimationFrame(animate);
            controls.update(); // Update controls
            renderer.render(scene, camera);
        }

        animate();

        // Adjust canvas size when the window is resized
        window.addEventListener('resize', function () {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        // Toggle sidebar visibility
        let sidebarVisible = false;
        document.getElementById('toggleSidebar').addEventListener('click', function () {
            sidebarVisible = !sidebarVisible;
            document.getElementById('sidebar').style.display = sidebarVisible ? 'block' : 'none';
        });

        // Event listeners for sidebar buttons
        document.getElementById('livingRoomButton').addEventListener('click', function () {
            moveCamera({ x: 29, y: 8.4, z: -11 }, { x: -2.47, y: 1.1, z: 2.52 });
        });

        document.getElementById('rooftopButton').addEventListener('click', function () {
            moveCamera({ x: 19, y: 25, z: -6 }, { x: -1.16, y: 0.5, z: 0.91 });
        });

        document.getElementById('balconyButton').addEventListener('click', function () {
            moveCamera({ x: 6, y: 10.5, z: 29 }, { x: -0.34, y: 0.2, z: 0.06 });
        });

        document.getElementById('frontButton').addEventListener('click', function () {
            moveCamera({ x: 35, y: 4.5, z: 18 }, { x: -0.25, y: 1.1, z: 0.22 });
        });

        document.getElementById('backButton').addEventListener('click', function () {
            moveCamera({ x: -25, y: 11, z: -24 }, { x: -2.72, y: -0.8, z: -2.84 });
        });
    </script>
</body>
</html>
